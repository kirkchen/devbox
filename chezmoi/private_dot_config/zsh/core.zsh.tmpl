{{- if eq .chezmoi.os "darwin" }}
# Homebrew (macOS only - check both Intel and Apple Silicon paths)
if [[ -f "/opt/homebrew/bin/brew" ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -f "/usr/local/bin/brew" ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
fi
{{- end }}

# fzf - Fuzzy finder
if [[ -f "$HOME/.fzf.zsh" ]]; then
    source "$HOME/.fzf.zsh"
elif [[ -f "/usr/share/doc/fzf/examples/key-bindings.zsh" ]]; then
    source "/usr/share/doc/fzf/examples/key-bindings.zsh"
fi

# fzf configuration (with fallback)
if command -v ag &> /dev/null; then
    export FZF_DEFAULT_COMMAND='ag --nocolor -g ""'
elif command -v rg &> /dev/null; then
    export FZF_DEFAULT_COMMAND='rg --files --hidden --follow --glob "!.git/*"'
else
    export FZF_DEFAULT_COMMAND='find . -type f -not -path "*/\.*"'
fi
export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_ALT_C_COMMAND='find . -type d -not -path "*/\.*" 2>/dev/null | head -200'

{{- if eq .chezmoi.os "darwin" }}
# iTerm2 Shell Integration (macOS only)
[[ -f "${HOME}/.iterm2_shell_integration.zsh" ]] && source "${HOME}/.iterm2_shell_integration.zsh"
{{- end }}


# direnv - Per-directory environment variables
if command -v direnv &> /dev/null; then
    eval "$(direnv hook zsh)"
fi

# z - Jump around
if [[ -f "$HOME/.oh-my-zsh/plugins/z/z.sh" ]]; then
    source "$HOME/.oh-my-zsh/plugins/z/z.sh"
fi